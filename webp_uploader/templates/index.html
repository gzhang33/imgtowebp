<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WebP Uploader</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        margin: 24px;
        line-height: 1.4;
      }
      .container {
        max-width: 980px;
        margin: 0 auto;
      }
      .card {
        border: 1px solid rgba(127, 127, 127, 0.35);
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: end;
      }
      label {
        display: block;
        font-size: 0.92rem;
        margin-bottom: 6px;
        opacity: 0.85;
      }
      input[type="text"],
      input[type="number"],
      input[type="file"] {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(127, 127, 127, 0.35);
        background: transparent;
      }
      .field {
        min-width: 220px;
        flex: 1;
      }
      .actions {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      button {
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(127, 127, 127, 0.35);
        background: rgba(127, 127, 127, 0.12);
        cursor: pointer;
        font-weight: 600;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        text-align: left;
        padding: 10px;
        border-bottom: 1px solid rgba(127, 127, 127, 0.25);
        vertical-align: top;
        word-break: break-word;
      }
      .status {
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.82rem;
      }
      .converted {
        color: #2e7d32;
      }
      .skipped {
        color: #ed6c02;
      }
      .failed {
        color: #d32f2f;
      }
      .muted {
        opacity: 0.75;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(127, 127, 127, 0.35);
        opacity: 0.9;
        font-size: 0.85rem;
      }
      @media (prefers-color-scheme: dark) {
        .converted {
          color: #81c784;
        }
        .skipped {
          color: #ffb74d;
        }
        .failed {
          color: #ef9a9a;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Upload images and convert to WebP</h2>
        <p class="muted">
          Supported: <span class="pill">.jpg</span> <span class="pill">.jpeg</span> <span class="pill">.png</span>
        </p>
        <form action="/upload" method="post" enctype="multipart/form-data">
          <div class="row">
            <div class="field">
              <label for="files">Files</label>
              <input id="files" name="files" type="file" multiple required />
            </div>
            <div class="field">
              <label for="quality">Quality (0-100)</label>
              <input id="quality" name="quality" type="number" min="0" max="100" value="80" />
            </div>
            <div class="field">
              <label for="subdir">Output subdir (optional)</label>
              <input id="subdir" name="subdir" type="text" placeholder="e.g. deck1" />
            </div>
          </div>
          <div style="height: 12px"></div>
          <div class="actions">
            <label style="display: flex; gap: 10px; align-items: center; margin: 0">
              <input type="checkbox" name="overwrite" />
              Overwrite existing .webp files
            </label>
            <button type="submit">Convert & Save</button>
          </div>
        </form>
        <p class="muted" style="margin-top: 12px">
          Output directory: <code>{{ output_dir }}</code>
        </p>
      </div>

      {% if summary %}
      <div class="card">
        <h3>Summary</h3>
        <table>
          <tbody>
            <tr><th>Files received</th><td>{{ summary.files_received }}</td></tr>
            <tr><th>Converted</th><td>{{ summary.converted }}</td></tr>
            <tr><th>Skipped</th><td>{{ summary.skipped }}</td></tr>
            <tr><th>Failed</th><td>{{ summary.failed }}</td></tr>
            <tr><th>Total input</th><td>{{ summary.total_input }}</td></tr>
            <tr><th>Total output</th><td>{{ summary.total_output }}</td></tr>
            <tr><th>Saved</th><td>{{ summary.saved }} ({{ summary.saved_pct }})</td></tr>
            <tr><th>Overwrite</th><td>{{ summary.overwrite }}</td></tr>
            <tr><th>Quality</th><td>{{ summary.quality }}</td></tr>
            <tr><th>Output subdir</th><td><code>{{ summary.subdir }}</code></td></tr>
          </tbody>
        </table>
      </div>
      {% endif %}

      {% if results %}
      <div class="card">
        <h3>Results</h3>
        <table>
          <thead>
            <tr>
              <th>File</th>
              <th>Status</th>
              <th>Message</th>
              <th>Output</th>
              <th>Size</th>
            </tr>
          </thead>
          <tbody>
            {% for r in results %}
            <tr>
              <td>{{ r.original_name }}</td>
              <td class="status {{ r.status }}">{{ r.status }}</td>
              <td>{{ r.message }}</td>
              <td>{% if r.output_relpath %}<code>{{ r.output_relpath }}</code>{% else %}-{% endif %}</td>
              <td>
                {% if r.input_bytes and r.output_bytes %}
                  {{ r.input_bytes }} B â†’ {{ r.output_bytes }} B
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </body>
</html>


